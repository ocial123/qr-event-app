<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RAVE Admin Dashboard</title>
<style>
  body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background: #1a1a2e;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: start;
    min-height: 100vh;
  }

  h1 { margin-top: 20px; color: #ff416c; text-shadow: 1px 1px 5px #ff4b2b; }

  button {
    background: linear-gradient(90deg, #ff416c, #ff4b2b);
    border: none;
    padding: 15px 30px;
    color: white;
    font-size: 18px;
    margin: 20px;
    cursor: pointer;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(255,75,43,0.5);
    transition: 0.3s;
  }

  button:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 20px rgba(255,75,43,0.7);
  }

  #scanner {
    border: 3px solid #ff416c;
    border-radius: 10px;
    margin-top: 20px;
  }

  #result {
    margin-top: 20px;
    font-size: 22px;
    padding: 10px 20px;
    border-radius: 10px;
    display: inline-block;
    min-width: 200px;
    text-align: center;
    font-weight: bold;
  }

  .valid { background: #28a745; color: #fff; }
  .invalid { background: #dc3545; color: #fff; }

  canvas.confetti {
    position: fixed;
    top: 0;
    left: 0;
    pointer-events: none;
    width: 100%;
    height: 100%;
  }
</style>
</head>
<body>

<h1>ðŸŽ‰ RAVE Admin Dashboard ðŸŽ‰</h1>
<p>Click the button to open camera and scan QR codes:</p>
<button id="start-scan-btn">Open Camera</button>

<video id="scanner" width="300" height="200" style="display:none;"></video>
<div id="result"></div>

<canvas class="confetti"></canvas>

<script src="https://unpkg.com/html5-qrcode"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
const video = document.getElementById('scanner');
const button = document.getElementById('start-scan-btn');
const resultBox = document.getElementById('result');
const confettiCanvas = document.querySelector('canvas.confetti');

function showResult(msg, valid) {
  resultBox.textContent = msg;
  resultBox.className = valid ? 'valid' : 'invalid';
  if(valid){
    confetti.create(confettiCanvas, { resize: true, useWorker: true })({
      particleCount: 100,
      spread: 70,
      origin: { y: 0.6 }
    });
  }
}

button.addEventListener('click', () => {
    video.style.display = 'block';  // show camera
    const html5QrcodeScanner = new Html5Qrcode("scanner");

    html5QrcodeScanner.start(
        { facingMode: "environment" },
        {
            fps: 10,
            qrbox: 250
        },
        qrCodeMessage => {
            fetch(`/admin/validate?token=${qrCodeMessage}`)
            .then(response => response.json())
            .then(data => showResult(data.message, data.status==='valid'))
            .catch(err => showResult('Error validating QR', false));
        },
        errorMessage => {
            // optional: can log scan errors
        }
    );
});
</script>
</body>
</html>
